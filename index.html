<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>DailyPulse ‚Äî News App</title>
<style>
  :root{
    --bg:#f6f7fb; --card:#fff; --text:#0b1320; --muted:#5b6871; --accent:#2563eb;
  }
  .dark{ --bg:#0b1220; --card:#0f1724; --text:#e6eef8; --muted:#9aa6b0; --accent:#60a5fa; }
  *{box-sizing:border-box}
  body{ margin:0; font-family:Inter, system-ui, Arial; background:var(--bg); color:var(--text); min-height:100vh; display:flex; flex-direction:column; }
  header{ display:flex; align-items:center; justify-content:space-between; padding:18px 28px; gap:12px; }
  h1{ margin:0; font-size:20px; }
  .controls{ display:flex; gap:8px; align-items:center; }
  .search{ padding:8px 12px; border-radius:8px; border:1px solid rgba(0,0,0,0.06); min-width:320px; background:var(--card); color:var(--text); }
  .container{ display:flex; gap:20px; padding:18px 28px; flex:1; }
  nav.sidebar{ width:220px; background:transparent; }
  .categories{ display:flex; flex-direction:column; gap:8px; }
  .cat-btn{ padding:10px 12px; border-radius:8px; border:none; background:transparent; text-align:left; cursor:pointer; color:var(--muted); }
  .cat-btn.active{ background: linear-gradient(90deg, rgba(37,99,235,0.12), rgba(96,165,250,0.06)); color:var(--accent); font-weight:600; }
  main{ flex:1; display:flex; flex-direction:column; gap:12px; }
  .news-grid{ display:grid; grid-template-columns:repeat(2, 1fr); gap:12px; }
  .card{ background:var(--card); border-radius:12px; padding:12px; display:flex; gap:12px; box-shadow: 0 6px 18px rgba(7,11,20,0.06); }
  .thumb{ width:160px; height:100px; border-radius:8px; background:#ddd; object-fit:cover; flex-shrink:0; }
  .meta{ flex:1; display:flex; flex-direction:column; }
  .title{ font-size:15px; margin:0 0 6px 0; line-height:1.2; }
  .desc{ color:var(--muted); font-size:13px; margin:0 0 8px 0; }
  .actions{ display:flex; gap:8px; margin-top:auto; align-items:center; }
  .btn{ padding:8px 10px; font-size:13px; border-radius:8px; border:none; cursor:pointer; background:transparent; color:var(--muted); }
  .btn.primary{ background:var(--accent); color:white; padding:8px 12px; }
  footer.bottom-nav{ height:72px; display:flex; align-items:center; justify-content:space-around; border-top:1px solid rgba(0,0,0,0.06); background:var(--card); }
  .nav-item{ display:flex; flex-direction:column; align-items:center; gap:4px; color:var(--muted); cursor:pointer; }
  .nav-item.active{ color:var(--accent); font-weight:600; }
  .tracking{ width:320px; display:flex; flex-direction:column; gap:12px; }
  .metric{ background:var(--card); padding:12px; border-radius:10px; box-shadow:0 6px 18px rgba(7,11,20,0.04); }
  .small{ font-size:13px; color:var(--muted); }
  @media (max-width:1100px){
    .container{ padding:12px; }
    .news-grid{ grid-template-columns:1fr; }
    .sidebar{ display:none; }
    .tracking{ display:none; }
  }
</style>
</head>
<body>
<header>
  <div style="display:flex;align-items:center;gap:12px;">
    <h1>üóûÔ∏èDailyPulse</h1>
    <div class="controls">
      <input id="searchInput" class="search" placeholder="Search news... (press Enter)" />
    </div>
  </div>
  <div style="display:flex;gap:10px;align-items:center;">
    <button id="darkToggle" class="btn" style="font-size:18px;">üåô</button>
    <button id="refreshBtn" class="btn" style="font-size:18px;">üîÑ</button>
  </div>
</header>

<div class="container">
  <nav class="sidebar">
    <div style="margin-bottom:12px;"><strong>Categories</strong></div>
    <div class="categories" id="categories"></div>
  </nav>

  <main id="mainArea">
    <div style="display:flex;justify-content:space-between;align-items:center;">
      <div><strong id="currentCategory">Top Headlines</strong></div>
      <div style="color:var(--muted);font-size:13px;">Showing <span id="resultsCount">0</span> articles</div>
    </div>
    <div id="newsGrid" class="news-grid"></div>
  </main>

  <aside class="tracking">
    <div class="metric"><div class="small">Current Streak</div><div id="currentStreak" style="font-size:22px;font-weight:700;">0 days</div></div>
    <div class="metric"><div class="small">Articles Today</div><div id="todayCount" style="font-size:18px;font-weight:600;">0</div></div>
    <div class="metric"><div class="small">Last 7 days total</div><div id="weekTotal" style="font-size:18px;font-weight:600;">0</div></div>
    <div class="metric"><div class="small">Category-wise reads</div><div id="catCounts" style="margin-top:8px;"></div></div>
  </aside>
</div>

<footer class="bottom-nav">
  <div id="navNews" class="nav-item active">üì∞<div style="font-size:13px;">News</div></div>
  <div id="navTrack" class="nav-item">üìä<div style="font-size:13px;">Tracking</div></div>
</footer>

<script>
const API_KEY = 'babc802ff2662c1bce0f17137271a30b';
const BASE = 'https://gnews.io/api/v4/top-headlines';
const categories = ['general','business','technology','entertainment','health','sports'];
const state = { category:'general', articles:[] };

const newsGrid = document.getElementById('newsGrid');
const categoriesEl = document.getElementById('categories');
const currentCategory = document.getElementById('currentCategory');
const resultsCount = document.getElementById('resultsCount');
const searchInput = document.getElementById('searchInput');
const refreshBtn = document.getElementById('refreshBtn');
const currentStreakEl = document.getElementById('currentStreak');
const todayCountEl = document.getElementById('todayCount');
const weekTotalEl = document.getElementById('weekTotal');
const catCountsEl = document.getElementById('catCounts');
const navNews = document.getElementById('navNews');
const navTrack = document.getElementById('navTrack');
const mainArea = document.getElementById('mainArea');
const trackingPanel = document.querySelector('.tracking');
const darkToggle = document.getElementById('darkToggle');

function setupCategories(){
  categories.forEach(c=>{
    const btn=document.createElement('button');
    btn.className='cat-btn';
    btn.textContent=c.charAt(0).toUpperCase()+c.slice(1);
    btn.onclick=()=>selectCategory(c,btn);
    categoriesEl.appendChild(btn);
  });
  categoriesEl.children[0].classList.add('active');
}
setupCategories();

function selectCategory(cat,btn){
  state.category=cat;
  currentCategory.textContent=cat.charAt(0).toUpperCase()+cat.slice(1);
  Array.from(categoriesEl.children).forEach(b=>b.classList.remove('active'));
  btn.classList.add('active');
  loadNews();
}

async function loadNews(query){
  const q=query?`&q=${encodeURIComponent(query)}`:'';
  const url=`${BASE}?category=${state.category}&lang=en&country=in&max=12&apikey=${API_KEY}${q}`;
  try{
    const res=await fetch(url);
    const data=await res.json();
    state.articles=data.articles||[];
    renderNews();
  }catch(e){
    newsGrid.innerHTML='<div style="color:red">Error fetching news.</div>';
  }
}

function renderNews(){
  newsGrid.innerHTML='';
  resultsCount.textContent=state.articles.length;
  state.articles.forEach(a=>{
    const card=document.createElement('article');
    card.className='card';
    const img=document.createElement('img');
    img.className='thumb';
    img.src=a.image||'https://via.placeholder.com/160x100?text=No+Image';
    const meta=document.createElement('div');
    meta.className='meta';
    const title=document.createElement('h3');
    title.className='title';
    title.textContent=a.title||'No title';
    const desc=document.createElement('div');
    desc.className='desc';
    desc.textContent=a.description||'';
    const act=document.createElement('div');
    act.className='actions';

    const listen=document.createElement('button');
    listen.className='btn'; listen.textContent='üîä Listen';
    listen.onclick=()=>speak(a.title+'. '+a.description);
    const save=document.createElement('button');
    save.className='btn'; save.textContent='üíæ Save';
    save.onclick=()=>saveArticle(a);
    const share=document.createElement('button');
    share.className='btn'; share.textContent='üì§ Share';
    share.onclick=()=>shareArticle(a);
    const read=document.createElement('button');
    read.className='btn primary'; read.textContent='Read more';
    read.onclick=()=>{window.open(a.url,'_blank');markRead(a);};

    act.append(listen,save,share,read);
    meta.append(title,desc,act);
    card.append(img,meta);
    newsGrid.append(card);
  });
}

function speak(text){
  if(!window.speechSynthesis)return alert('Not supported');
  window.speechSynthesis.cancel();
  const u=new SpeechSynthesisUtterance(text);
  speechSynthesis.speak(u);
}

function saveArticle(a){
  const saved=JSON.parse(localStorage.getItem('savedArticles')||'[]');
  if(saved.find(s=>s.url===a.url))return alert('Already saved');
  saved.unshift(a);
  localStorage.setItem('savedArticles',JSON.stringify(saved));
  alert('Saved!');
}

async function shareArticle(a){
  const p={title:a.title,text:a.description,url:a.url};
  if(navigator.share){try{await navigator.share(p);}catch(e){}} 
  else{await navigator.clipboard.writeText(a.url); alert('Link copied');}
}

function markRead(a){
  const reads=JSON.parse(localStorage.getItem('reads')||'{}');
  const d=new Date();const k=d.toISOString().slice(0,10);
  if(!reads[k])reads[k]={count:0,categories:{}};
  reads[k].count++; const c=state.category;
  reads[k].categories[c]=(reads[k].categories[c]||0)+1;
  localStorage.setItem('reads',JSON.stringify(reads));
  updateTracking();
}

function streak(){
  const r=JSON.parse(localStorage.getItem('reads')||'{}');
  let s=0;const t=new Date();
  for(let i=0;;i++){const d=new Date(t);d.setDate(t.getDate()-i);
    const k=d.toISOString().slice(0,10);
    if(r[k]&&r[k].count>0)s++;else break;
  }return s;
}

function updateTracking(){
  const r=JSON.parse(localStorage.getItem('reads')||'{}');
  const t=new Date(),k=t.toISOString().slice(0,10);
  const today=(r[k]||{count:0}).count;
  let week=0,catT={};
  for(let i=0;i<7;i++){
    const d=new Date(t);d.setDate(t.getDate()-i);
    const k2=d.toISOString().slice(0,10);
    if(r[k2]){week+=r[k2].count;
      for(const c in r[k2].categories)
        catT[c]=(catT[c]||0)+r[k2].categories[c];
    }
  }
  currentStreakEl.textContent=streak()+' days';
  todayCountEl.textContent=today;
  weekTotalEl.textContent=week;
  catCountsEl.innerHTML='';
  categories.forEach(c=>{
    const div=document.createElement('div');
    div.className='small';
    div.textContent=`${c}: ${(catT[c]||0)}`;
    catCountsEl.append(div);
  });
}

/* === Dark / Light Toggle with Emoji === */
const savedMode = localStorage.getItem('darkMode');
let isDark = savedMode ? JSON.parse(savedMode) : window.matchMedia('(prefers-color-scheme:dark)').matches;
document.documentElement.classList.toggle('dark', isDark);
darkToggle.textContent = isDark ? '‚òÄÔ∏è' : 'üåô';
darkToggle.onclick = () => {
  isDark = !isDark;
  document.documentElement.classList.toggle('dark', isDark);
  darkToggle.textContent = isDark ? '‚òÄÔ∏è' : 'üåô';
  localStorage.setItem('darkMode', isDark);
};

searchInput.onkeydown=e=>{if(e.key==='Enter')loadNews(searchInput.value);}
refreshBtn.onclick=()=>loadNews();

navNews.onclick=()=>{navNews.classList.add('active');navTrack.classList.remove('active');mainArea.style.display='flex';trackingPanel.style.display='';}
navTrack.onclick=()=>{navTrack.classList.add('active');navNews.classList.remove('active');mainArea.style.display='none';trackingPanel.style.display='flex';}

loadNews();updateTracking();
</script>
</body>
</html>
